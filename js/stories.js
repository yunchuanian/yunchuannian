// 小说数据
const storiesData = {
    'xun-main-1': {
        title: '第一章·梦境回廊',
        content: `
            <h3>第一章·梦境回廊</h3>
            <p>珣第一次意识到自己与众不同，是在十二岁那年的夏天...</p >
            <p>那是一个闷热的午后，蝉鸣声穿透纱窗，珣躺在竹席上昏昏欲睡。朦胧间，他感觉自己的意识开始漂浮，就像被风吹起的一片羽毛，轻飘飘地离开了身体。</p >
            <p>当他再次"睁开"眼睛时，发现自己站在一片陌生的花园里。这里的花草都泛着淡淡的蓝光，空气中飘荡着若有若无的香气。</p >
            <p>"这是哪里？"珣惊讶地环顾四周，声音在空旷的花园里回荡。</p >
            <p>远处，一个模糊的身影正在修剪花枝。那个身影转过身来，珣惊讶地发现那竟然是自己的祖母...</p >
        `
    },
    'xun-main-2': {
        title: '第二章·记忆碎片',
        content: `
            <h3>第二章·记忆碎片</h3>
            <p>珣开始了寻找失落记忆的旅程...</p >
            <p>梦境回廊中的每一面镜子都映照着他过去的片段，有些清晰，有些模糊。</p >
            <p>在其中一面镜子前，珣看到了小时候的自己，正和祖母在花园里玩耍...</p >
        `
    },
    'xun-main-3': {
        title: '第三章·命运交织',
        content: `
            <h3>第三章·命运交织</h3>
            <p>在梦境的最深处，珣遇到了..</p >
            <p>这位神秘的梦境旅人似乎知道很多关于珣的秘密。</p >
            <p>"你的能力比想象中更强大，"颜愈君微笑着说，"但你需要学会控制它。"</p >
        `
    },
    'xun-extra-1': {
        title: '1.童年往事',
        content: `
            <h3>童年往事</h3>
            <p>珣的童年充满了奇异的经历...</p >
            <p>五岁那年，他第一次"梦游"到了邻居家的花园，把所有人都吓了一跳。</p >
            <p>八岁时，他开始在梦中看到未来的片段，虽然当时他并不知道那是什么...</p >
        `
    },
    'xun-extra-2': {
        title: '2.方术笔记',
        content: `
            <h3>方术笔记</h3>
            <p>珣对方术的学习始于一本古老的笔记...</p >
            <p>笔记中记载了许多奇异的符号和咒语，有些甚至让珣感到不安。</p >
            <p>但他知道，要掌握自己的能力，就必须理解这些古老的智慧...</p >
        `
    }
};


storiesData['xun-extra-2'] = {
    title: '2.方术笔记',
    content: `
        <h3>方术笔记</h3>
        <p>珣对方术的学习始于一本偶然得到的古老笔记，这本笔记改变了他的人生轨迹...</p >
        
        <p>笔记的扉页上用苍劲的笔迹写着："天地有灵，万物有象。观其象而知其理，察其变而通其道。"</p >
        
        <p>笔记中详细记载了各种奇异的符号和咒语：</p >
        
        <ul>
            <li>梦境符咒：用于进入他人梦境或守护自己的梦境</li>
            <li>时空印记：标记特定时空坐标的神秘符号</li>
            <li>灵视符文：增强感知能力的特殊图案</li>
        </ul>
        
        <p>珣最初对这些内容感到既好奇又恐惧。有些咒语的力量超出了他的想象，甚至让他感到不安。</p >
        
        <div class="quote">
            "力量本身并无善恶，关键在于使用者的心念。"——笔记中的一句话让珣深思良久。
        </div>
        
        <p>随着学习的深入，珣开始理解这些古老智慧的深意。他知道，要真正掌握自己的能力，就必须深入理解这些方术的精髓...</p >
    `
};

storiesData['xun-extra-3'] = {
    title: '3.梦境解析',
    content: `
        <h3>梦境解析</h3>
        <p>珣逐渐学会解读梦境中的各种符号和意象，这些解析帮助他更好地理解自己和他人的内心世界...</p >
        
        <p>在长期的实践中，珣总结出了一套独特的梦境解析方法：</p >
        
        <h4>常见梦境符号解析</h4>
        <ul>
            <li><strong>蓝蝴蝶：</strong>象征潜意识的指引，通常出现在重要的转折点</li>
            <li><strong>破碎的镜子：</strong>代表自我认知的困惑或身份认同的危机</li>
            <li><strong>无尽回廊：</strong>暗示生活中的循环模式或未解决的问题</li>
            <li><strong>雨中行走：</strong>表示情感上的洗礼或心灵净化</li>
        </ul>
        
        <div class="quote">
            "每个梦境都是一封来自潜意识的情书，等待我们去解读。"——珣的梦境笔记
        </div>
        
        <p>通过这些解析，珣不仅帮助他人理解梦境，也加深了对自身能力的认识...</p >
    `
};

// 新增小短篇数据
storiesData['xun-short-1'] = {
    title: '《蓝蝶之梦》',
    content: `
        <h3>《蓝蝶之梦》</h3>
        <p>那只蓝蝴蝶总是在珣即将醒来时出现，翅膀上闪烁着奇异的光芒...</p >
        
        <p>珣追着蝴蝶穿过一片片梦境花园，蝴蝶的翅膀洒下细小的光点，在空气中划出优美的弧线。他们飞过镜面般的湖泊，镜中倒映着无数个珣的身影，每个身影都在做着不同的动作。</p >
        
        <p>"等等！"珣喊道，但蝴蝶只是飞得更快了，仿佛在引导他去往某个特定的地方。</p >
        
        <p>最终，他们来到一座水晶桥前。蝴蝶停在桥中央，翅膀轻轻扇动，发出悦耳的铃声。珣小心翼翼地靠近，伸出手想要触碰它。</p >
        
        <div class="quote">
            "追寻者，你终于来了。"一个空灵的声音在珣的脑海中响起。
        </div>
        
        <p>就在他的手指即将碰到蝴蝶的瞬间，蝴蝶突然化作无数光点消散了。珣猛地睁开眼睛，发现自己躺在床上，窗外已是清晨。</p >
        
        <p>他的指尖还残留着一丝蓝色的光芒，但很快就消失了。只有床单上那片蓝色的鳞粉，证明昨晚的梦境并非虚幻...</p >
    `
};

storiesData['xun-short-2'] = {
    title: '《镜中花》',
    content: `
        <h3>《镜中花》</h3>
        <p>那面古镜是珣在古董市场偶然发现的，镜面上布满了岁月的痕迹，却依然能清晰地映照出人影...</p >
        
        <p>更奇怪的是，镜中映出的景象似乎总比现实慢上半拍。当珣移动时，镜中的影子要过一会儿才会跟着移动。</p >
        
        <p>一天深夜，珣被一阵细微的声响惊醒。他走到镜前，发现镜中竟然映出了一片从未见过的花园，花园中央坐着一个身着古装的女子。</p >
        
        <p>女子抬起头，对着珣微微一笑："你能看见我？"</p >
        
        <p>珣惊讶地发现，女子说的话他居然能听懂，尽管那是一种古老的语言。</p >
        
        <div class="quote">
            "镜花水月，皆是虚妄。但虚妄之中，亦有真情。"女子轻声说道。
        </div>
        
        <p>从此，每当月圆之夜，珣就能通过这面古镜与那个时代的女子对话，了解那个时代的故事...</p >
    `
};

// 新增小剧场数据
storiesData['xun-scene-1'] = {
    title: '梦境茶会',
    content: `
        <h3>梦境茶会</h3>
        <p>茶壶自动倾斜，为珣倒出一杯冒着七彩雾气的茶...</p >
        
        <p>珣坐在一张漂浮在空中的圆桌旁，对面是一只穿着礼服的兔子，正用怀表计算着时间。</p >
        
        <p>"你迟到了三分二十七秒。"兔子严肃地说，推了推鼻梁上的单片眼镜。</p >
        
        <p>珣有些尴尬地整理了一下衣襟："抱歉，我迷路了。这里的路标总是变来变去。"</p >
        
        <p>兔子哼了一声，从马甲口袋里掏出一块精致的怀表："所有造梦者都会迷路，这是传统。就像所有兔子都会戴怀表一样。"</p >
        
        <div class="quote">
            "时间在梦境中是最不可靠的东西，"兔子晃动着怀表说，"但又是最重要的礼仪。"
        </div>
        
        <p>茶杯自动飞到珣的手中，茶水的颜色不断变化，从蓝色变成紫色，又变成金色。珣小心翼翼地尝了一口，味道像是星空和薄荷的混合。</p >
        
        <p>"这是什么茶？"珣好奇地问。</p >
        
        <p>"记忆茶，"兔子优雅地抿了一口自己的茶，"喝下它，你就能看到你最珍贵的记忆。不过要小心，有时候也会看到别人的记忆。"</p >
        
        <p>珣犹豫了一下，又喝了一口。瞬间，无数画面在他眼前闪过——童年的花园、第一次使用能力的时刻、还有那个总是在梦中出现的蓝衣女子...</p >
    `
};

storiesData['xun-scene-2'] = {
    title: '夜话方术',
    content: `
        <h3>夜话方术</h3>
        <p>油灯在桌上投下摇曳的光影，珣和老者相对而坐，中间摊开着那本古老的方术笔记...</p >
        
        <p>"你看这里，"老者指着笔记上的一段符文，"这个符号不是简单的装饰，而是能量的导流器。"</p >
        
        <p>珣凑近细看，发现那些看似随意的线条确实构成了某种精妙的能量通道："所以它能够引导梦境能量？"</p >
        
        <p>"不止如此，"老者摇摇头，"它还能稳定时空结构，防止梦境崩塌。你知道为什么有些造梦者会迷失在梦境中吗？"</p >
        
        <p>珣思索片刻："因为他们无法维持梦境的稳定性？"</p >
        
        <div class="quote">
            "正是如此，"老者满意地点点头，"方术不是魔法，而是对自然规律的深刻理解。"
        </div>
        
        <p>夜渐深，两人的讨论却越发激烈。从符文结构到能量流动，从梦境层次到时空维度...</p >
        
        <p>"记住，孩子，"老者在告别时说，"真正的力量来自于理解，而不是盲从。这些笔记只是引路人，真正的道路需要你自己去探索。"</p >
        
        <p>珣望着老者远去的背影，心中充满了新的感悟。他知道，今晚的对话将是他方术修行的重要转折点...</p >
    `
};

// 修改事件监听，添加对所有类型卡片的支持
document.addEventListener('DOMContentLoaded', function() {
    // 原有的角色切换代码...
    
    // 修改为监听所有类型的故事卡片
    const storyCards = document.querySelectorAll('.story-card, .extra-card, .short-card, .scene-card');
    storyCards.forEach(card => {
        card.addEventListener('click', function() {
            const storyId = this.dataset.story;
            openReader(storyId);
        });
    });
    
    // 原有的其他代码...
});

// 初始化
document.addEventListener('DOMContentLoaded', function() {
    // 角色切换
    const characterBtns = document.querySelectorAll('.character-btn');
    characterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            // 更新按钮状态
            characterBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // 切换内容
            const characterId = this.dataset.character;
            document.querySelectorAll('.character-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${characterId}-content`).classList.add('active');
        });
    });
    
    // 故事卡片点击事件
    const storyCards = document.querySelectorAll('.story-card, .extra-card');
    storyCards.forEach(card => {
        card.addEventListener('click', function() {
            const storyId = this.dataset.story;
            openReader(storyId);
        });
    });
    
    // 关闭阅读器
    document.getElementById('closeReader').addEventListener('click', closeReader);
    
    // 点击模态框背景关闭
    document.getElementById('readerModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeReader();
        }
    });
    
    // 键盘事件（ESC键关闭）
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeReader();
        }
    });
});

// 打开阅读器
function openReader(storyId) {
    const story = storiesData[storyId];
    if (!story) return;
    
    document.getElementById('readerTitle').textContent = story.title;
    document.getElementById('readerContent').innerHTML = story.content;
    document.getElementById('readerModal').style.display = 'block';
    
    // 禁用背景滚动
    document.body.style.overflow = 'hidden';
}

// 关闭阅读器
function closeReader() {
    document.getElementById('readerModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// 搜索功能
document.querySelector('.search-btn').addEventListener('click', function() {
    const searchTerm = document.querySelector('.search-input').value.trim();
    if (searchTerm) {
        searchStories(searchTerm);
    }
});

// 搜索故事
function searchStories(term) {
    // 这里可以实现搜索逻辑
    console.log('搜索关键词:', term);
    alert(`搜索功能开发中，关键词: ${term}`);
}